// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String    @unique
  password      String?   // Hashed password
  role          UserRole  @default(USER)
  emailVerified DateTime?
  image         String?
  teamId        String?
  team          Team?     @relation(fields: [teamId], references: [id])
  meetings      Meeting[]
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

enum UserRole {
  ADMIN
  USER
}

model Team {
  id        String    @id @default(cuid())
  name      String
  users     User[]
  meetings  Meeting[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model Meeting {
  id               String               @id @default(cuid())
  title            String
  description      String?
  videoUrl         String?
  audioUrl         String?
  duration         Int?                 // in seconds
  status           MeetingStatus        @default(PENDING)
  meetingType      String?              // e.g., "DAILY", "1:1", "SALES"
  userId           String
  user             User                 @relation(fields: [userId], references: [id])
  teamId           String?
  team             Team?                @relation(fields: [teamId], references: [id])
  participants     Participant[]
  transcriptSegments TranscriptSegment[]
  summary          Summary?
  tasks            Task[]
  decisions        Decision[]
  createdAt        DateTime             @default(now())
  updatedAt        DateTime             @updatedAt
}

enum MeetingStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

model Participant {
  id        String  @id @default(cuid())
  name      String
  email     String?
  meetingId String
  meeting   Meeting @relation(fields: [meetingId], references: [id], onDelete: Cascade)
}

model TranscriptSegment {
  id          String  @id @default(cuid())
  startTime   Float
  endTime     Float
  speakerName String?
  text        String  @db.Text
  meetingId   String
  meeting     Meeting @relation(fields: [meetingId], references: [id], onDelete: Cascade)
}

model Summary {
  id           String  @id @default(cuid())
  content      String  @db.Text
  keyPoints    String? @db.Text // JSON string
  risks        String? @db.Text // JSON string
  templateUsed String?
  meetingId    String  @unique
  meeting      Meeting @relation(fields: [meetingId], references: [id], onDelete: Cascade)
}

model Task {
  id          String    @id @default(cuid())
  description String    @db.Text
  assignee    String?
  dueDate     DateTime?
  status      String    @default("OPEN") // OPEN, IN_PROGRESS, DONE
  position    Int       @default(0)
  meetingId   String
  meeting     Meeting   @relation(fields: [meetingId], references: [id], onDelete: Cascade)
}

model Decision {
  id          String  @id @default(cuid())
  description String  @db.Text
  meetingId   String
  meeting     Meeting @relation(fields: [meetingId], references: [id], onDelete: Cascade)
}

model AuditLog {
  id        String   @id @default(cuid())
  action    String
  entity    String
  entityId  String
  userId    String?
  details   String?  @db.Text
  createdAt DateTime @default(now())
}
